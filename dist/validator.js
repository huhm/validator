/*! validator v1.0.0 | huhuimei2008@gmail.com | https://github.com/huhm/validator */
define(function(require,exports,module){function verifyInputEvent(a,b){var c={radio:1,checkbox:1,file:1,select:1,hidden:1},d=b.type,e={};switch(d){case"keyup":case"focusin":e.isInputing=!0;break;case"click":e.isInputing=!0;break;case"change":e.isInputing=!c[a];break;case"focusout":case"validate":e.isInputing=!1}return e}var VALIDATE_METHOD={telephone:function(a){return/^[1][0-9]{10}$/.test(a)?!0:"请输入11位手机号码"},contact:function(a){return/^[1][0-9]{10}$/.test(a)?!0:/^((\d{3,4})-(\d{7,8})|(\d{3,4})-(\d{7,8})-(\d{1,4}))$/.test(a)?!0:"请输入手机号码或电话号码(区号-电话号码[-分机号])"},phone:function(a){return/^((\d{3,4})-(\d{7,8})|(\d{3,4})-(\d{7,8})-(\d{1,4}))$/.test(a)?!0:"电话号码格式：区号-电话号码[-分机号]"},email:function(a){return/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test(a)?!0:"邮箱格式错误"},minLength:function(a,b){return a.length>=b||"至少要有"+b+"个字符"},maxLength:function(a,b){return a.length<=b||"最多不超过"+b+"个字符"},minByteLength:function(a,b){var c=a.replace(/[^\x00-\xff]/g,"xx").length;return c>=b||"至少要有"+b+"个字节"},maxByteLength:function(a,b){var c=a.replace(/[^\x00-\xff]/g,"xx").length;return b>=c||"最多不超过"+b+"个字节"},numberRange:function(a,b){if(/^[-]?[0-9]+$/.test(a)){if(null==b)return!0;var c=parseInt(a,10);return null!=b[0]&&c<b[0]?"不可小于"+b[0]:null!=b[1]&&c>b[1]?"不可超过"+b[1]:!0}return"请输入整数"},floatRange:function(a,b){if(/^[-]?[0-9]+[.]?[0-9]*$/.test(a)){if(null==b)return!0;var c=parseFloat(a,10);return null!=b[0]&&c<b[0]?"不可小于"+b[0]:null!=b[1]&&c>b[1]?"不可超过"+b[1]:!0}return null==b?"请输入浮点型数据":"请输入范围为[ "+(null==b[0]?"--":b[0])+" , "+(null==b[1]?"--":b[1])+" ]浮点型数据"},floatPrecision:function(a,b){if(/^[-]?[0-9]+[.]?[0-9]*$/.test(a)){if(null==b)return!0;var c=a.indexOf("."),d=0,e=a.length;return c>=0&&(d=e-c-1,e=c),null!=b[0]&&d<b[0]?"至少要有"+b[0]+"位小数":null!=b[1]&&d>b[1]?"小数位不能超过"+b[1]+"位":!0}return null==b?"请输入浮点型数据":"请输入小数位数为"+(b[0]||"0")+" ~ "+(b[1]||"--")+"位的浮点型数据"},equal:function(a,b){return a==b||"应输入"+b},notEqual:function(a,b){return a!=b||"值不能为"+b},name:function(a){return/^([\u4E00-\uFA29]|[\uE7C7-\uE7F3]|[a-zA-Z0-9]|_)*$/.test(a)||"只能由中文、字母、数字、下划线组成"},checkboxCount:function(a,b){if(null==b)return!0;var c=a.split(",");return null!=b[0]&&(""==a||c.length<b[0])?"不可低于"+b[0]+"项":null!=b[1]&&c.length>b[1]?"不可超过"+b[1]+"项":!0}};exports.Common=VALIDATE_METHOD;var Browser={isIE:!!window.ActiveXObject};Browser.isIE&&(Browser.IE=10==document.documentMode?10:9==document.documentMode?9:window.postMessage?8:window.XMLHttpRequest?7:document.compatMode?6:window.createPopup?5.5:window.attachEvent?5:document.all?4:0);var FormHelper=function(a){a=$(a),this.container=a};FormHelper.prototype.GetInputDom=function(a){return this.container.find("[name='"+a+"']")},FormHelper.prototype._GetInputTypeByDom=function(a){var b;if(b="string"==typeof a?this.GetInputDom(a):a,b=b.first(),0===b.length)return null;switch(b[0].tagName.toLowerCase()){case"input":return{checkbox:"checkbox",radio:"radio",hidden:"hidden",file:"file",text:"text",password:"password"}[b.attr("type")]||"input";case"select":return"select";case"textarea":return"textarea";default:return"static"}},FormHelper.prototype.GetValue=function(a){var b=this.GetInputDom(a);return this._GetValue(b,!0)},FormHelper.prototype.GetText=function(a){var b=this.GetInputDom(a);if(null==b||0===b.length)return null;var c=this._GetInputTypeByDom(b);switch(c){case"select":return b.find("option:selected").text()}return null},FormHelper.prototype._GetValue=function(a,b){var c=this._GetInputTypeByDom(a);if(null==a||0===a.length)return null;switch(c){case"static":return a.html();case"select":return a.find("option:selected").val();case"checkbox":case"radio":b||(a=this.GetInputDom(a.attr("name")));var d=a.filter(":checked");if(a.length>0){var e=[];return d.each(function(a,b){e.push($(b).val())}),e.join(",")}return null;case"input":case"text":case"file":case"hidden":case"password":case"textarea":return a.val();default:return window.console&&window.console.warn&&window.console.warn("Validator:未定义类型："+c+",使用默认获取方式$ele.val();"),a.val()}},FormHelper.prototype.GetValues=function(){for(var a=this.container.find("[name]"),b={},c=0,d=a.length;d>c;c++){var e=$(a[c]),f=e.attr("name");void 0===b[f]&&(b[e.attr("name")]=this._GetValue(e,!1))}return b},FormHelper.prototype.SetValue=function(a,b,c){function d(){c&&("string"!=typeof c&&(c="validate"),e.trigger(c))}var e=this.GetInputDom(a),f=this._GetInputTypeByDom(a);if(null==e||0===e.length)return!1;null==b&&(b="");var g=typeof b;if("string"!=typeof b&&"number"!==g)return void(window.console&&window.console.warn&&window.console.warn("非string|number值不支持："+a+",value="+b));switch(f){case"static":e.html(b);break;case"checkbox":var h=","+b+",";e.each(function(){this.checked=h.indexOf(","+$(this).val()+",")>=0?!0:!1});break;case"radio":e.each(function(){this.checked=$(this).val()==b?!0:!1});break;case"input":case"text":case"hidden":case"password":case"textarea":e.val(b);break;case"select":if(Browser.isIE&&Browser.IE<7){var i=e.find('option[value="'+b+'"]');return setTimeout(function(){i.attr("selected",!0),d()},1),e}e.val(b);break;case"file":b||e.val("");break;default:window.console&&window.console.warn&&window.console.warn("Validator:未定义类型："+f+",使用默认设置值方式$ele.val(newValue);"),e.val(b)}return d(),e},FormHelper.prototype.SetValues=function(a,b){for(var c in a)this.SetValue(c,a[c],b)};var buildInValidators=VALIDATE_METHOD,DefaultValidateOption={name:null,type:"input",bindName:null,open:!0,triggerTarget:null,required:!1,tests:null,ajaxValidate:null,successTip:null,tipTarget:null,_oldHelpBlock:null,_validating:null,_lastValidateResult:null},TestingStatus={NotTest:0,Testing:1,CompleteTest:2,TestingCatchError:3,TestingFailBeforeAjax:4,TestingOk:5,TestingFail:6},DefaultConfig={status:{error:"has-error",success:"has-success",warning:"has-warning",all:"has-error has-success has-warning"},showErrorCnt:0,ajax:{inputingOpen:!1},formItemSel:".form-group",helpBlock:{autoAdd:!0,html:'<div class="help-block"></div>',selector:".help-block",container:".controls"}},Validator=function(a,b,c){a=$(a),this.container=a,this.Init(b,c)};return Validator.prototype=new FormHelper,Validator.prototype.constructor=Validator,Validator.prototype._getFormItemOptionFromDom=function(configItemJson){var res=configItemJson||{},that=this;return this.container.find("[data-validator]").each(function(){var $this=$(this),name=$this.attr("name"),item=res[name]||{},tmp;if(item.name=name,item.type=item.type||that._GetInputTypeByDom($this),"string"!=typeof item.required&&(tmp=$this.attr("data-validator"),tmp.toLowerCase().indexOf("required")>-1&&(item.required=!0),tmp=$this.attr("data-validator-required"),null!=tmp&&(item.required=$this.attr("data-validator-required")||!0,"true"===item.required&&(item.required=!0))),tmp=$this.attr("data-validator-bind"),tmp&&(item.bindName=tmp),item.tests=item.tests||[],tmp=$this.attr("data-validator-tests")){var testNameAry=tmp.split("|"),msgAry=$this.attr("data-validator-message");msgAry=msgAry?msgAry.split("|"):[];for(var i=0,len=testNameAry.length;len>i;i++)if(testNameAry[i]){var tt=[];tt.push(testNameAry[i]),tt.push(msgAry[i]?msgAry[i]:null);var exParam=$this.attr("data-validator-param-"+(i+1));exParam=exParam?eval(exParam):exParam,tt.push(exParam),item.tests.push(tt)}}tmp=$this.attr("data-validator-reg-1");for(var regNum=1;tmp;){var regMsg=$this.attr("data-validator-reg-message-"+regNum),tt=[];tt.push(eval(tmp)),tt.push(regMsg?regMsg:null),tt.push(null),item.tests.push(tt),regNum++,tmp=$this.attr("data-validator-reg-"+regNum)}if(0===item.tests.length&&(item.tests=null),tmp=$this.attr("data-validator-ajax")){var url=tmp,dataType="true"===$this.attr("data-validator-ajax-jsonp")?"jsonp":"json";item.ajaxValidate=function(a,b){$.ajax(url,{data:{value:b},dataType:dataType,type:"POST",success:function(b){a(b.error?b.data:!0)},error:function(){a("服务器校验失败",!0)}})}}tmp=$this.attr("data-validator-success"),null!=tmp&&(item.successTip=tmp),tmp=$this.attr("data-validator-tip"),tmp&&(item.tipTarget=tmp),res[name]=item}),res},Validator.prototype._refreshOrAddOption=function(a,b){var c=this.options[a];if(c)b.open===!1&&c.open===!0&&this.Clear(a),b=$.extend(!0,c,b);else{b.name=a;var d=this.getFormItemObj(a);b.type||(b.type=this._GetInputTypeByDom(a)),b=$.extend(!0,{},DefaultValidateOption,b),b._oldHelpBlock=d.find(this.validatorOption.helpBlock.selector).html(),this.optionLength++}if(b.triggerTarget){var e=b.triggerTarget;e="string"==typeof e?this.container.find(e):$(e),e.attr("pl-validator",a)}if(b.bindName)for(var f=b.bindName,g=f.split(","),h=0,i=g.length;i>h;h++){var j=this.container.find('[name="'+g[h]+'"]');j.attr("pl-validator-bind",a)}this.options[a]=b},Validator.SetDefault=function(a){$.extend(!0,DefaultConfig,a)},Validator.prototype.Init=function(a,b){this.validatorOption=$.extend(!0,{},this.validatorOption||DefaultConfig,a||{}),b=this._getFormItemOptionFromDom(b),this.options={};var c=this;this.optionLength=0;for(var d in b)this._refreshOrAddOption(d,b[d]);this.container.off("click.Validator focus.Validator keyup.Validator blur.Validator change.Validator validate.Validator").on("click.Validator focus.Validator keyup.Validator blur.Validator change.Validator validate.Validator","[name],[pl-validator],[pl-validator-bind]",function(a){var b=$(this),d=b.attr("name"),e=b.attr("pl-validator"),f=b.attr("pl-validator-bind");if(d){var g=c._GetInputTypeByDom(b),h=verifyInputEvent(g,a);c.Test(d,null,h.isInputing,a.timeStamp)}e&&c.Test(e,null,!1,a.timeStamp),f&&c.Test(f,null,!1,a.timeStamp)})},Validator.prototype.TestAll=function(a){return this._testItems(this.options,this.optionLength,a)},Validator.prototype._testItems=function(a,b,c){function d(a,d){e++,1!=a&&(f=!1,g.push(d)),e===b&&c&&c(f,g,g.length)}var e=0,f=!0,g=[],h=!0,i=!1;for(var j in a){i=!0;var k=this.Test(a[j],d);k!==!0&&(h=!1)}return i||e!==b||c&&c(f,g,g.length),h},Validator.prototype.TestPart=function(a,b){var c=this.options,d=0,e={};return a.find("[name]").add(a.filter("[name]")).each(function(){var a=$(this).attr("name"),b=c[a];b&&!e[a]&&(d++,e[a]=b)}),this._testItems(e,d,b)},Validator.prototype.Test=function(a,b,c,d){function e(a,d,e,g,h){var i;if(0===arguments.length)i=!0,a=f._lastValidateResult.result;else{var k=TestingStatus.TestingFailBeforeAjax;0===a.error?k=TestingStatus.TestingOk:g?k=TestingStatus.TestingCatchError:h&&(k=TestingStatus.TestingFail),i=!1,f._lastValidateResult={value:d,bindValue:e,status:k,result:a,inputing:c}}return j._ShowTestResult(f,c,i),0===a.error?(b&&b(!0,[]),!0):(b&&b(!1,a.msg),!1)}var f=a,g=a;if("string"==typeof a?f=this.options[a]:g=f.name,!f)return b&&b(!0,[]),!0;if(f.open!==!0)return b&&b(!0,[]),!0;var h,i=this.GetValue(g),j=this,k={error:0,msg:[]};if(f.bindName){for(var l=f.bindName.split(","),m=[],n=0,o=l.length;o>n;n++)m.push(this.GetValue(l[n]));h=m.join("|")}return f._validating&&f._validating.bindValue===h&&f._validating.value===i&&f._validating.inputing===c&&d&&d-f._validating.timeStamp<500&&!b?!0:(f._validating={value:i,bindValue:h,timeStamp:d||0,inputing:c},f.required&&(i||(k.error++,k.msg.push("不可为空"))),0===k.error&&(i||h)&&(f.tests&&(k=j._TestTests(f.tests,i,f)),0===k.error&&f.ajaxValidate)?f._lastValidateResult&&f._lastValidateResult.bindValue===h&&f._lastValidateResult.value===i&&f._lastValidateResult.status>TestingStatus.TestingFailBeforeAjax?e():(this.validatorOption.ajax.inputingOpen||!c?(this._RenderHelpBlock(f,1,"<ul role='result'><li>正在校验...</li></ul>"),f.ajaxValidate.call(this,function(a,b){a=a===!0?{error:0,msg:b?[b]:[]}:{error:1,msg:[a||"校验出错"]};var c=!1;return"boolean"==typeof b&&(c=b),e(a,i,h,c,!0)},i)):this._revertHelpBlock(f),!0):e(k,i,h))},Validator.prototype._TestTests=function(a,b){for(var c=[],d=0,e=0,f=a.length;f>e;e++){var g,h,i;$.isArray(a[e])?(g=a[e][0],h=a[e][1],i=a[e][2]):(g=a[e].method,h=a[e].msg,i=a[e].param);var j;"string"==typeof g?j=buildInValidators[g](b,i):g instanceof RegExp?j=g.test(b):"function"==typeof g&&(j=g.call(this,b,a)),j!==!0&&(h&&("string"==typeof h?j=h:"function"==typeof h&&(j=h.call(this,b,j))),j||(j="格式错误"),c.push(j),d++)}return{error:d,msg:c}},Validator.prototype.getTipObj=function(a){var b,c;"string"==typeof b?(b=a,c=this.options[b]||{}):(b=a.name,c=a);var d;if(c.tipTarget)d=c.tipTarget,d="string"==typeof d?this.container.find(d):"function"==typeof d?d.call(this,b,c,this.container):$(d);else{var e=this.getFormItemObj(b);if(d=e.find(this.validatorOption.helpBlock.selector),0===d.length&&this.validatorOption.helpBlock.autoAdd===!0){var f=e.find(this.validatorOption.helpBlock.container);0===f.length&&(f=e),d=$(this.validatorOption.helpBlock.html).appendTo(f)}}return c.tipTarget=d,d},Validator.prototype.getFormItemObj=function(a){return this.GetInputDom(a).closest(this.validatorOption.formItemSel)},Validator.prototype._revertHelpBlock=function(a,b,c){var d=a;"string"==typeof a&&(d=this.options[a]),b||(b=this.getFormItemObj(d.name)),c||(c=this.getTipObj(d)),b.removeClass(this.validatorOption.status.all),c.html(d._oldHelpBlock||"")},Validator.prototype._ShowTestResult=function(a,b,c){if(!a._lastValidateResult)return void this._revertHelpBlock(a);if(a._lastValidateResult.result&&0===a._lastValidateResult.result.error){var d=a.successTip;a._lastValidateResult.result.msg.length>0&&(d=a._lastValidateResult.result.msg[0]),null!=d&&a._lastValidateResult.status===TestingStatus.TestingOk?this._RenderHelpBlock(a,0,"<ul role='result'><li>"+d+"</li></ul>"):this._revertHelpBlock(a)}else{var e=2;if(b&&(e=1),c)this._RenderHelpBlock(a,e);else{for(var f=["<ul role='result'>"],g=a._lastValidateResult.result.msg,h=this.validatorOption.showErrorCnt||g.length,i=0;h>i;i++)f.push("<li>"+g[i]+"</li>");f.push("</ul>"),this._RenderHelpBlock(a,e,f.join(""))}}},Validator.prototype._RenderHelpBlock=function(a,b,c){var d=this.getTipObj(a),e=this.getFormItemObj(a.name);0===b?(e.removeClass(this.validatorOption.status.all).addClass(this.validatorOption.status.success),null!=c&&d.html(c)):(e.removeClass(this.validatorOption.status.success),1===b?e.removeClass(this.validatorOption.status.error).addClass(this.validatorOption.status.warning):e.removeClass(this.validatorOption.status.warning).addClass(this.validatorOption.status.error),null!=c&&d.html(c))},Validator.prototype.Destroy=function(){this.Clear(),this.container.off("click.Validator focus.Validator keyup.Validator blur.Validator change.Validator validate.Validator")},Validator.prototype.Clear=function(a){function b(a){var b=c.options[a];c._revertHelpBlock(b||a),b&&(b._validating=null,b._lastValidateResult=null)}var c=this;if(a)b(a);else for(var d in c.options)b(d)},Validator.prototype.ItemOption=function(a,b){this._refreshOrAddOption(a,b)},Validator.BuildInValidator=function(a,b){return b?void(buildInValidators[a]=b):buildInValidators[a]},Validator.FormHelper=FormHelper,Validator});